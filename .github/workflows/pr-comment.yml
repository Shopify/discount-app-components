name: Comment on PR

on:
  pull_request:
    types: [opened, reopened]

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Comment PR
        uses: actions/github-script@v3
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            const pr = context.payload.pull_request
            const repo = context.repo
            const octokit = github
            let isExternalContributor = false

            try {
              await octokit.orgs.getMembershipForUser({
                org: 'Shopify',
                username: pr.user.login,
              });
            } catch (err) {
              isExternalContributor = true
            }

            if (isExternalContributor) {
              github.issues.createComment({
                ...repo,
                issue_number: pr.number,
                body: 'Hello and thank you for your contribution! Before we can merge your pull request, we ask that you create a changeset to describe your changes. This will help us manage versions and release notes. You can create a changeset by running `yarn changeset` in your terminal. You can find more information about our contribution guidelines [here](https://github.com/Shopify/discount-app-components/blob/main/CONTRIBUTING.md). Thank you again!'
              })
            }
